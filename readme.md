# IMPORTANT
#### THIS SOFTWARE IS UNDER THE JHU ACADEMIC SOFTWARE LICENSE AGREEMENT (SEE "LICENSE"). PLEASE CONSULT THE LICENSE BEFORE PROCEEDING. 


# SSCAR Instructions

## 1. Overview
* `/heart_volume/` contains the definition of the universal heart volume data class `HeartVolume`. This represents patients' 3-D MRI scans and additional metadata used to preserve geometrical properties (e.g., spatial orientation).
* `/scar_learning/` contains the core of the project:
    - `/scar_learning/apnet/` contains model definition, training, and evaluation for SSCAR.
    - `/scar_learning/baseline/` contains model definition, training, and evaluation for Cox proportional hazards model.
    

## 2. Data Generation
This project uses raw DICOM files for the LGE-MRI data and an additional .csv file containing patient covariate and outcome data. These data are subject to HIPAA and can only be shared subject to Institutional Review Board approval. 

`heart_volume.data_process.data_processing_hv_dict(...)` is used to process DICOM files into the universal `HeartVolume` class, which includes slice-by-slice left ventricle myocardium segmentations. For details on the segmentation process, see [Abramson & Popescu et al.][1].

### SSCAR 
SSCAR data generators are located in `/scar_learning/apnet/apnet_datagen.py`. 

### Cox proportional hazards
Data for Cox proportional hazards are extracted in `/scar_learning/baseline/baseline_data.py`. 


## 2. Model Definition
### SSCAR
SSCAR dense, convolutional and ensembled neural network model definitions can be found in `/scar_learning/apnet/apnet_model.py`.

### Cox proportional hazards
Standard survival model definition (e.g., Cox proportional hazards) are found in `/scar_learning/baseline/baseline_model.py`.


## 3. Hyperparameter sweep
SSCAR hyperparameter search is performed by `scar_learning.apnet.apnet_hypersearch.apnet_hypersearch_optimal_params_kfold(...)`

Cox proportional hazards hyperparameter search is performed by `scar_learning.baseline.baseline_model.cox_hypersearch_optimal_params_kfold(...)`


## 4. Validation and Testing
### SSCAR 
Cross-validated numbers for the internal cohort were generated by calling `scar_learning.apnet.apnet_validate.validate_kfold_fixed(...)`. Testing on the external cohort was performed using `scar_learning.apnet.apnet_test.test_overall(...)` and `scar_learning.apnet.apnet_test.test_kfold_fixed(...)` (for confidence interval estimation).   

### Cox proportional hazards
Similarly to SSCAR, the functions `cox_test_kfold_fixed(...)` in `~/baseline/baseline_model.py` and `test_overall(...)` in `~/baseline/baseline_test.py` were use to validate (internal) and test (external) the Cox proportional hazards models. 


## 5. Analysis of results
Analysis of results was performed in `/scar_learning/apnet/apnet_analysis.py`.


## Technical notes
* Python package requirements are found in `/environment.yml`
* Some code requires an installation of MATLAB and the associated engine for Python
* The code was optimized to run efficiently on NVIDIA GPUs with 24GB of memory.
* `/scar_learning/config_data.py` and `/scar_learning/data_process.py` are bespoke to way the raw input data file structure was established. Although the raw data were not provided, these files should aid with understanding of the overall code.

[1]: https://arxiv.org/abs/2010.11081
